var cviaja=angular.module("dplan",["ngRoute","routes","services"]);cviaja.controller("activitiesCtrl",["activities","helpers","$scope","$q","$http","$window","$location","$rootScope",function(t,e,a,o,i,n,c,r){function s(t,e){swal(t,e,"success")}a.search="Autopista norte",document.title="DPlan, Planes unicos cerca a Bogotá",a.activities=[],a.contact={},t.doRequest("/getActivities",function(t){a.activities=t.data.activities}),a.irA=function(t,a){e.createUrl(t,a,function(t){c.url(r.urlFinal)})},a.subscripbeUser=function(){t.doPostRequest("/saveContact",{mail:a.activities.mail},function(t){s("¡Suscripción exitosa!",t.data.token),a.activities.mail=""})},a.searcSite=function(t){a.search=t},a.sendNewContact=function(){t.doPostRequest("/saveContact",a.contact,function(t){s("¡Bienvenido a DPlan!","Ya guardamos tus datos nos pondremos en contacto contigo."),a.contact={}})}}]),cviaja.controller("activityCtrl",["activities","helpers","$scope","$routeParams","$rootScope","$location",function(t,e,a,o,i,n){function c(t){var e={lat:parseFloat(t.lat),lng:parseFloat(t.lng)};a.map=new google.maps.Map(document.getElementById("map"),{zoom:14,center:e});new google.maps.Marker({position:e,map:a.map});var o=document.getElementById("pac-input"),i=new google.maps.places.SearchBox(o);a.map.controls[google.maps.ControlPosition.TOP_LEFT].push(o),a.map.addListener("bounds_changed",function(){i.setBounds(a.map.getBounds())});i.addListener("places_changed",function(){var t=i.getPlaces();s=new google.maps.DirectionsService,l=new google.maps.DirectionsRenderer,a.paintRoute(t[0].geometry.location.lat(),t[0].geometry.location.lng())})}i.checkOut=[],i.referals=[];var r=new Date;a.validSince=r.getFullYear()+"-"+r.getMonth()+"-"+r.getDate();var s,l,u=2===o.activity.split("_").length?o.activity.split("_"):window.location="/",d=24===u[1].length?u[1]:window.location="/";t.doRequest("/getActivity?id="+d,function(o){if(i.activity=o.data.activity[0],i.lengthPagerImages=i.activity.carousel.length,a.tab=1,a.tabs=1,document.title=i.activity.name,c(i.activity.location),void 0!==i.activity.legalInfo){for(i.activity.legalInfo=i.activity.legalInfo.split("&"),i.activity.detailPlan=i.activity.detailPlan.split("&"),r=0;r<i.activity.legalInfo.length;r++)i.activity.legalInfo[r].replace("&"," ");for(r=0;r<i.activity.detailPlan.length;r++)i.activity.detailPlan[r].replace("&"," ")}-1!==i.activity.categories.indexOf(",")?(i.catFind=i.activity.categories.split(","),i.catFind=i.catFind[0]):i.catFind=i.activity.categories,t.getReferals("/getReferals",{categories:i.catFind},function(t){i.referals=t.data}),a.irA=function(t,a){e.createUrl(t,a,function(t){n.url(i.urlFinal)})}}),a.validDate=function(){},a.checkCupo=function(t){i.checkOut=[],localStorage.setItem("checkOut",null),i.activity.qtyBuyed=document.getElementById("sel1").value,i.activity.dateReserv=document.getElementById("dateR").value,i.activity.total=i.activity.mount*i.activity.qtyBuyed,localStorage.setItem("checkOut",JSON.stringify(i.activity))},a.reservA=function(t){void 0===i.activity.dateReserv||""===i.activity.dateReserv?swal("error","Debes elegir una fecha y el número de cupos a comprar","error"):window.location="/#!/checkout"},a.paintRoute=function(t,e){marker=[];var o={origin:new google.maps.LatLng(t,e),destination:new google.maps.LatLng(parseFloat(a.activity.location.lat),parseFloat(a.activity.location.lng)),travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC,provideRouteAlternatives:!1};l.addListener("directions_changed",function(){var t=l.getDirections().routes[0];i.activity.distance=t.legs[0].distance.text,i.activity.distanceValue=t.legs[0].distance.value/1e3}),s.route(o,function(t,e){e==google.maps.DirectionsStatus.OK&&(l.setMap(a.map),l.setPanel($("#panel_ruta").get(0)),l.setDirections(t))})},a.range=function(t,e,a){a=a||1;for(var o=[],i=t;i<=e;i+=a)o.push(i);return o},a.openRnt=function(t){swal({title:"Registro Nacional De Turismo",html:'<img src="'+t+'" style="width: 100%;height: 280px;">',showCancelButton:!1})},a.contact={name:"",mail:""},a.suscribir=function(){""!==a.contact.name&&""!==a.contact.mail?suscribe():swal("error","Debes ingresar tu nombre y correo","error")}}]),cviaja.controller("checkoutCtrl",["$scope","$rootScope","$window",function(t,e,a){function o(){e.activity?(t.total=1,checkout=window.localStorage.getItem("checkOut"),e.activity=checkout?JSON.parse(checkout):{}):t.total=0}t.key="154facda17519d661d60dc5384a5681d",o(),t.deletePlan=function(a){swal("Eliminado!","Plan eliminado correctamente","success"),e.activity={},t.total=0,window.localStorage.setItem("checkout",null)},t.goBack=function(){window.history.back()}}]),cviaja.controller("responseCtrl",["payment","$scope","$window","$location",function(t,e,o,i){function n(t){var e=[];for(a=0;a<t;a++)e.push(c.prefixCode+Math.floor(1e3*Math.random()));return e}e.resultTransaction={};var c=JSON.parse(localStorage.getItem("checkOut")),r=i.search().ref_payco;t.getInfoTransaction(r,function(a){e.resultTransaction=a,1===e.resultTransaction.x_cod_response?(codes=n(c.qtyBuyed),t.createBooking({name:a.x_business,mail:a.x_customer_email,idActivity:c._id,mount:a.x_amount,quantity:c.qtyBuyed,codes:codes,wasPayment:!0,statusPayment:a.x_response,codeTransaction:a.x_id_invoice,dateReserv:c.dateReserv}),swal("¡Compra exitosa!","Tu transacción ha sido satisfactoria, a tu correo hemos enviado la información completa sobre tu actividad, Disfrútala!!","success")):2===e.resultTransaction.x_cod_response?swal("¡Compra rechazada!","Tu transacción ha sido rechazada, valida esta información con tu banco y vuelve a intentarlo, no te quedes con las ganas de hacer este plan.","error"):3===e.resultTransaction.x_cod_response?swal("¡Compra Pendiente!","Tu transacción está en estado Pendiente, te informaremos a vuelta de correo una vez cambie el estado de tu compra.","warning"):swal("¡Compra fallida!","Ha ocurrido un error con tu compra, verifica con tu entidad financiera para mas información","error")}),e.goBack=function(){localStorage.setItem("checkOut",null),window.history.back()}}]),cviaja.controller("blogCtrl",function(){});